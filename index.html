<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />
  <title>Brainwave Sync (isochronic)</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 1.25rem; background:#0b1220; color:#e5e7eb; }
    .wrap { max-width: 1000px; margin: 0 auto; }
    .card { padding: 1.25rem; border-radius: 16px; background:#111827; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    h1, h2 { margin: .25rem 0 .75rem; }
    .param-title { margin-top: 0; }
    .row { display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; }
    .col { display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; }
    
    input[type='number'] {
      width: 4.5rem;
      background: transparent;
      color: #e5e7eb;
      border: 0;
      outline: none;
      text-align: right;
      font-size: 1rem;
    }
    input[type='checkbox'] { transform: translateY(1px); }
    button { padding:.3rem .6rem; border-radius:12px; border:0; cursor:pointer; background:#2563eb; color:white; font-weight:600; }
    button.secondary { background:#334155; }
    button.preset-btn.active { background: #60a5fa; }
    .preset-btn {
      width: 100px;
      text-align: center;
      white-space: normal;
      word-wrap: break-word;
    }
    small.muted { opacity:.8 }
    canvas { background:#0b1220; border-radius: 12px; display:block; width:100%; height:350px; }
    pre { white-space:pre-wrap; background:#0b1220; padding:.75rem; border-radius:.75rem; overflow:auto; }
    
    .header-grid {
      display: grid;
      grid-template-columns: 1.4fr .6fr;
      gap: 1rem;
      align-items: baseline;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      align-items: start; /* Aligns items to the top */
    }

    /* New Parameter Styles */
    .param-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: .1rem 0;
    }
    .param-label { color: #cbd5e1; }
    .param-unit { color: #64748b; font-size: .9rem; }
    .input-wrapper {
      display: flex;
      align-items: center;
      background: #0b1220;
      padding: .4rem .6rem;
      border-radius: .7rem;
      border: 1px solid #1f2937;
      gap: .35rem;
    }
    #pointEditor .param-row { padding: .3rem 0; }

    @media (min-width: 840px) { .grid { grid-template-columns: 1.4fr .6fr; } }

    /* Modal Styles */
    .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    .modal-content { background: #111827; padding: 1.5rem; border-radius: 16px; width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    .modal-content h2 { margin-top: 0; }
    .modal-content .param-row { margin-bottom: 1rem; }
    .modal-content .input-wrapper { width: 100%; }
    .modal-content input[type='text'] { width: 100%; background: transparent; color: #e5e7eb; border: 0; outline: none; font-size: 1rem; }
    .modal-buttons { display: flex; justify-content: flex-end; gap: .75rem; margin-top: 1.5rem; }

    #togglePlaybackBtn {
      width: 100px;
      background-color: #16a34a; /* Green */
    }

    #togglePlaybackBtn.secondary {
      background-color: #dc2626; /* Red */
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header-grid">
        <h1>Brainwave Sync</h1>
        <h2 class="param-title">Parameters</h2>
      </div>
      
      <div class="grid">
        <div>
          <canvas id="sched" width="1000" height="350"></canvas>
                    <div class="row" style="margin-top:.5rem">
            <button id="togglePlaybackBtn">Start</button>
            <div id="presetsContainer" class="row" style="flex-grow: 1; justify-content: center;"></div>
          </div>
          <p id="presetDescription" style="margin-top:.5rem; color: #94a3b8;"></p>
          <pre id="readout" style="margin-top:.5rem"></pre>
        </div>
        
        <div>
          <div id="paramsContainer" style="display: flex; flex-direction: column; align-items: flex-start; gap: .5rem; width: 100%;">
            
            <div class="param-row">
              <span class="param-label">Carrier tone</span>
              <div class="input-wrapper">
                <input id="carrier" type="number" value="400" min="1">
                <span class="param-unit">Hz</span>
              </div>
            </div>

            <div class="param-row">
              <span class="param-label">Start beat</span>
              <div class="input-wrapper">
                <input id="startBeat" type="number" value="7" step="0.1" min="0.1">
                <span class="param-unit">Hz</span>
              </div>
            </div>

            <hr style="width: 100%; border-color: #1f2937; margin: .5rem 0;">

            <div class="param-row">
              <span class="param-label">Total points</span>
              <div class="input-wrapper">
                <input id="totalPoints" type="number" value="1" min="1" max="10">
              </div>
            </div>

            <div id="singlePointDurationContainer" style="display: none; width: 100%;">
              <div class="param-row">
                <span class="param-label">Duration</span>
                <div class="input-wrapper">
                  <input id="singlePointHours" type="number" value="0" min="0" style="width: 3rem;">
                  <span class="param-unit">h</span>
                  <input id="singlePointMinutes" type="number" value="30" min="0" max="59" style="width: 3rem;">
                  <span class="param-unit">m</span>
                </div>
              </div>
            </div>

            <div id="pointEditor" style="display: flex; flex-direction: column; gap: .5rem; padding: .75rem; border: 1px solid #1f2937; border-radius: .7rem; width: calc(100% - 1.5rem); box-sizing: border-box;">
              <div class="param-row">
                <span class="param-label"><strong>Edit Point</strong></span>
                <div class="input-wrapper">
                  <input id="editPointSelector" type="number" value="2" min="2" max="10">
                </div>
              </div>
              <div class="param-row">
                <span class="param-label">Beat</span>
                <div class="input-wrapper">
                  <input id="pointBeat" type="number" value="2" step="0.1" min="0.1">
                  <span class="param-unit">Hz</span>
                </div>
              </div>
              <div class="param-row">
                <span class="param-label">Time since previous</span>
                <div class="input-wrapper">
                  <input id="pointHours" type="number" value="0" min="0" style="width: 3rem;">
                  <span class="param-unit">h</span>
                  <input id="pointMinutes" type="number" value="30" min="0" max="59" style="width: 3rem;">
                  <span class="param-unit">m</span>
                </div>
              </div>
            </div>

            <div class="param-row" style="margin-top: .5rem;">
              <span class="param-label">After the end</span>
              <div class="input-wrapper">
                <select id="endAction" style="background:transparent; color:#e5e7eb; border:0; outline: none; -webkit-appearance: none; appearance: none;">
                  <option value="hold" style="background:#0b1220;">Hold last beat</option>
                  <option value="stop" style="background:#0b1220;">Stop sound</option>
                </select>
              </div>
            </div>

            <div class="param-row">
              <button id="saveBtn" class="secondary">Save as WAV</button>
              <div class="input-wrapper">
                <select id="exportSampleRate" style="background:transparent; color:#e5e7eb; border:0; outline: none; -webkit-appearance: none; appearance: none;">
                  <option value="44100" style="background:#0b1220;">High (44.1 kHz)</option>
                  <option value="22050" style="background:#0b1220;">Medium (22.05 kHz)</option>
                  <option value="8000" style="background:#0b1220;">Low (8 kHz)</option>
                </select>
              </div>
            </div>

            <div class="param-row">
                <span class="param-label">Mute</span>
                <label class="input-wrapper" style="padding: .6rem;"><input id="mute" type="checkbox"></label>
            </div>

          </div>
          <p><small class="muted">Disclaimer: This app is for relaxation and entertainment purposes only. Brainwave sessions may induce drowsiness or other altered states of awareness. Do not use while driving or in situations requiring full alertness. Any use on user's responsibility</small></p>
        </div>
      </div>

    </div>
  </div>
  <div id="renamePresetModal" class="modal-backdrop" style="display: none;">
    <div class="modal-content">
      <h2>Edit Preset</h2>
      <form id="renamePresetForm">
        <div class="param-row">
          <label for="presetNameInput" class="param-label">Name</label>
          <div class="input-wrapper">
            <input id="presetNameInput" type="text" required>
          </div>
        </div>
        <div class="param-row">
          <label for="presetDescriptionInput" class="param-label">Description</label>
          <div class="input-wrapper">
            <input id="presetDescriptionInput" type="text">
          </div>
        </div>
        <div class="modal-buttons">
          <button type="submit" id="savePresetNameBtn">Save</button>
          <button type="button" id="cancelPresetNameBtn" class="secondary">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  <script type="module" src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js'); }
  </script>
</body>
</html>
